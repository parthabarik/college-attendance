<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Session Data</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f7fa;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .data-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #00c9a7;
        }

        .data-label {
            font-weight: 600;
            color: #555;
            margin-top: 10px;
        }

        .data-value {
            color: #333;
            font-family: 'Courier New', monospace;
            background: #fff;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            word-break: break-all;
        }

        .status {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .btn {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .btn-clear {
            background: #ff6b6b;
            color: white;
        }

        .btn-refresh {
            background: #00c9a7;
            color: white;
        }

        .btn-back {
            background: #5a70d5;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            transition: all 0.3s;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîç Session Data Checker</h1>

        <div id="statusMessage"></div>

        <div class="data-section">
            <h2>Student Session Data:</h2>
            <div id="sessionData"></div>
        </div>

        <div class="data-section">
            <h2>Validation:</h2>
            <div id="validation"></div>
        </div>

        <div style="margin-top: 20px;">
            <button class="btn btn-refresh" onclick="location.reload()">üîÑ Refresh</button>
            <button class="btn btn-clear" onclick="clearSession()">üóëÔ∏è Clear Session & Logout</button>
            <button class="btn btn-back" onclick="goBack()">‚¨ÖÔ∏è Go Back</button>
        </div>
    </div>

    <script>
        function checkSession() {
            const statusDiv = document.getElementById('statusMessage');
            const dataDiv = document.getElementById('sessionData');
            const validationDiv = document.getElementById('validation');

            // Check if student session exists
            const studentData = sessionStorage.getItem('student');

            if (!studentData) {
                statusDiv.innerHTML = '<div class="status status-warning">‚ö†Ô∏è No student session found. You are not logged in.</div>';
                dataDiv.innerHTML = '<p style="color: #999;">No data to display</p>';
                validationDiv.innerHTML = '<p style="color: #999;">Please login first</p>';
                return;
            }

            try {
                const student = JSON.parse(studentData);

                // Display raw data
                dataDiv.innerHTML = `
          <div class="data-label">Raw JSON:</div>
          <div class="data-value">${JSON.stringify(student, null, 2)}</div>
          
          <div class="data-label">ID:</div>
          <div class="data-value">${student.id || '<span style="color: red;">‚ùå MISSING</span>'}</div>
          
          <div class="data-label">Full Roll No:</div>
          <div class="data-value">${student.fullRollNo || '<span style="color: orange;">Not set</span>'}</div>
          
          <div class="data-label">Roll No:</div>
          <div class="data-value">${student.rollNo || '<span style="color: orange;">Not set</span>'}</div>
          
          <div class="data-label">Name:</div>
          <div class="data-value">${student.name || '<span style="color: orange;">Not set</span>'}</div>
          
          <div class="data-label">Email:</div>
          <div class="data-value">${student.email || '<span style="color: orange;">Not set</span>'}</div>
          
          <div class="data-label">Branch:</div>
          <div class="data-value">${student.branch || '<span style="color: orange;">Not set</span>'}</div>
          
          <div class="data-label">Section:</div>
          <div class="data-value">${student.section || '<span style="color: orange;">Not set</span>'}</div>
          
          <div class="data-label">Semester:</div>
          <div class="data-value">${student.semester || '<span style="color: orange;">Not set</span>'}</div>
        `;

                // Validation
                let validationHtml = '';
                let allGood = true;

                // Check for ID
                if (!student.id) {
                    validationHtml += '<div class="status status-error">‚ùå CRITICAL: ID field is missing! QR scanning will NOT work.</div>';
                    allGood = false;
                } else {
                    validationHtml += '<div class="status status-success">‚úÖ ID field exists: ' + student.id + '</div>';
                }

                // Check for fullRollNo
                if (!student.fullRollNo) {
                    validationHtml += '<div class="status status-warning">‚ö†Ô∏è WARNING: fullRollNo is missing</div>';
                } else {
                    validationHtml += '<div class="status status-success">‚úÖ fullRollNo exists: ' + student.fullRollNo + '</div>';
                }

                // Check for name
                if (!student.name) {
                    validationHtml += '<div class="status status-warning">‚ö†Ô∏è WARNING: Name is missing</div>';
                } else {
                    validationHtml += '<div class="status status-success">‚úÖ Name exists: ' + student.name + '</div>';
                }

                validationDiv.innerHTML = validationHtml;

                if (allGood) {
                    statusDiv.innerHTML = '<div class="status status-success">‚úÖ Session data is valid! QR scanning should work.</div>';
                } else {
                    statusDiv.innerHTML = '<div class="status status-error">‚ùå Session data is INVALID! Please logout and login again.</div>';
                }

            } catch (error) {
                statusDiv.innerHTML = '<div class="status status-error">‚ùå Error parsing session data: ' + error.message + '</div>';
                dataDiv.innerHTML = '<div class="data-value" style="color: red;">' + studentData + '</div>';
            }
        }

        function clearSession() {
            if (confirm('Are you sure you want to clear all session data and logout?')) {
                sessionStorage.clear();
                alert('Session cleared! Redirecting to home page...');
                window.location.href = 'index.html';
            }
        }

        function goBack() {
            window.history.back();
        }

        // Run check on page load
        checkSession();
    </script>
</body>

</html>